# 机器人逻辑

单人游戏模式（人类玩家 vs 1-5个bot），bot难度为**困难级**，追求最大胜率，公共区翻牌为随机抽取。bot严格知道自己的完整手牌（排序列表），但对其他玩家和公共区只能通过观察和推理获取信息。

### bot的记忆系统（完美记忆 + 推理）

bot维护一个全局知识库，实时更新：

- **自己的手牌**：完整排序列表（从小到大），包括相同数字。知道精确的头值（最小）和尾值（最大），以及手牌数量。
- **其他玩家的手牌信息**：
  - 当前手牌（包括已知的牌和未知的牌）。
  - 已知头值（如果曾经成功翻开过该玩家的最小牌且之后未移除该端，则当前头仍是该值）。
  - 已知尾值（同理）。
  - 下界和上界推理：头值 → 所有牌 ≥ 该值；尾值 → 所有牌 ≤ 该值。
  - 已排除的数字：结合全局牌库和已见牌推理某些数字不可能在该玩家手中。
  - 手牌可能有重复数字（同数字多张连在一起）。翻头后如果有重复，头值不变直到移除。
- **已收集的三条**：每位玩家（包括自己）已收集的数字套数和具体数字（因为成功时三张牌是公开的）。
- **公共区信息**：
  - 剩余牌（包括已知的牌和未知的牌）。
- **全局牌库追踪**：
  - 每个数字1-12剩余多少张（初始3张，减去已收集的三条，减去已知位置的牌）。
- **历史翻牌记录**：所有曾经翻开的牌（值 + 来源），用于持续更新上述推理。

每次任何牌被翻开（无论成功或失败），bot立即重新计算所有概率和可能目标。

### bot决策流程（困难级，追求胜率）

bot每回合会尝试多条链（直到失败），决策目标是**最大化当回合预期收集三条的数量**

#### 总体框架

当前链状态分为四种：空链、已翻1张（目标数字T）、已翻2张（目标T，已有两张）。

每次选择下一张翻牌时，bot枚举所有可能行动（所有玩家的头/尾 + 公共区），计算该行动的**期望收益**（成功概率 × 收益 + 失败风险），选择期望最高的行动。

收益定义：成功收集一套三条 = +1套（向胜利靠近）。

#### 严格优先级（基于你提供的框架，优化后）

1. **最高优先：已知能立即完成三张相同（确定性三条）**

   - 如果当前已有2张T，且存在至少一个行动能100%翻到T（例如某玩家头/尾已知是T，或自己的头/尾是T），直接选择那个确定性行动。
   - 这几乎是必执行，因为确定性成功率100%，且能继续回合。

2. **次高优先：已知有两张相同（当前链有1张T，或空链但能开启高价值链）**

   - 当前链已有1张T：寻找剩余的第三张T（优先确定性来源 → 高概率来源）。
   - 空链但已知某处有两张可立即翻的相同牌（例如两个已知头/尾都是同一个数字S）：先翻其中一个作为起点，再按高概率找第二张S，最后确定性翻第三个。
   - 寻找策略：
     - 先扫描所有已知头/尾是否是T。
     - 再计算公共区概率：剩余T张数 / 公共区剩余总数。
     - 再对未知头/尾估算概率：结合该玩家下界/上界、排除数字、全局剩余T张数、该玩家手牌数量，计算“该端是T”的概率（用超几何分布近似）。
     - 选择概率最高的来源翻第三张。
     - 如果概率都很低，考虑放弃当前链（故意翻不匹配结束回合，防止暴露信息）——困难bot会计算是否值得冒险。

3. **中等优先：只有单张已知（探索潜在三条）**

   - 扫描所有已知头/尾和自己的手牌，找出剩余张数最多的数字（全局剩余2或3张的数字优先）。
   - 优先翻“最大”或“最小”已知值作为起点（因为极端值往往信息价值高，暴露后对手难以利用）。
   - 然后寻找该数字的另外两张：
     - 优先高概率来源（同上，确定性 > 公共区概率 > 未知端估算概率）。
     - 如果全局剩余只有1张，跳过该数字（不可能成三条）。

4. **最低优先：纯探索（场上无好机会）**
   - 随机但带偏向地揭示信息：
     - 优先翻对手的头/尾（尤其是手牌多的对手，获取下界/上界信息）。
     - 避免翻自己的头/尾（除非必要，防止暴露）。
     - 偶尔翻公共区（获取已知在公共区的牌，缩小不确定性）。
   - 选择标准：信息价值最高。
